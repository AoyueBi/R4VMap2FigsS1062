---
title: "Data analysis"
author: "Aoyue Bi, Daxing Xu"
date: "`r Sys.Date()`"
output: 
  html_document: # html_notebook, html_document
    toc: true
    toc_float:
      toc_collapsed: true
    toc_depth: 3
    number_sections: true
    theme: simplex # default, united, cerulean, journal, flatly, darkly, readable, spacelab, united, cosmo, lumen, paper, sandstone, simplex, and yeti
    highlight: haddock # default, tango, pygments, kate, monochrome, espresso, zenburn, haddock, and breezedark
    # bibliography: bibliography.json
---

# Fig1

```{r}
setwd("/Users/Aoyue/project/wheatVMapII/003_dataAnalysis/zz_rProject/R4VMap2Figs")
```

```{r setup, echo =F, message = T, warning = F}
library(tidyverse)
library(RColorBrewer)
library(ggpubr)
library(egg)
## eval 代码要不要运行
## echo 代码要不要输出
## include 图要不要输出
## warning 警告要不要输出
## message 默认Bin等信息要不要输出
```

## Fig1|World map
```{r}
### 检查Taxa来自多少个国家
df <- read_tsv("data/001_TaxaDB/WheatVMap2_GermplasmInfo.txt")
dfcountry <- df %>% group_by(orgCty) %>% count()
numCountry <- nrow(dfcountry)
print(str_c("The sample in VMap2 project comes from ",numCountry," countries"))

```




## ***************
## 以下来自上一版本
## ================
## Fig.1\|World map

```{r}
dataFile <- c("data/taxa_InfoDB.txt")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
mp<-NULL #定义一个空的地图  
# 注意： borders函数中的colour是地图国家边界线的颜色,fill是国家的填充颜色
mapworld<-borders("world",colour = "#dedfe0",fill="#dedfe0") #绘制基本地图
mpvoid<-ggplot()+ mapworld + ylim(-55,90)+theme_void()
mpvoid
colB <- c("#ffd702","#fc6e6e","#87cef9")
mp<-mpvoid+geom_point(data=df,aes(x=df$Longitude,y=Latitude,fill = GenomeType
),shape=21,alpha=0.8,size=2)+
  scale_fill_manual(values = colB)+
  theme(legend.position = 'none')
mp
# ggsave(mp,filename = "figs/map_s643.pdf", height = 7.48,width = 13.7)
ggsave(mp,filename = "figs/map_s643.pdf", height = 2.76,width = 6.89)

```

### mk legend

```{r}
colB <- c("#ffd702","#fc6e6e","#87cef9")
x <- c(1,2,3)
y <- c(1,1,3)
z <- c("DD","AABB","AABBDD")
df <- data.frame(x=x,y=y,z=z)
head(df)
### 图例加边框
p <- ggplot(data=df,aes(x=x,y=y,fill=z))+geom_point(shape=21)+scale_fill_manual(values = colB,name='')+
  theme_void()+
  theme(legend.box.background=element_rect(color = "black"),legend.position = c(.5, .5),
        legend.margin = margin(0.03, 3, 3, 2))
### 图例不加边框
p <- ggplot(data=df,aes(x=x,y=y,fill=z))+geom_point(shape=21)+scale_fill_manual(values = colB,name='')+
  theme_void()+
  theme(legend.position = c(.5, .5))
p
ggsave(p,filename = "~/Documents/legend.pdf", height = 3, width = 3)



### 图例加边框
p <- ggplot(data=df,aes(x=x,y=y,fill=z))+geom_point(shape=8)+scale_color_manual(values = colB,name='')+
  theme_void()+
  theme(legend.box.background=element_rect(color = "black"),legend.position = c(.5, .5),
        legend.margin = margin(0.03, 3, 3, 2))
ggsave(p,filename = "~/Documents/legend.pdf", height = 3, width = 3)

```

### map group by subspecies

```{r}
library(maps)
library(maptools)
#dataFile <- c("data/taxa_InfoDB.txt")
dataFile <- c("/Users/Aoyue/project/wheatVMapII/003_dataAnalysis/zz_rProject/R4VMap2Figs/data/taxa_InfoDB.txt")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
head(df)
levels(df$TreeValidatedGroupbySubspecies)
colB <- c("#87cef9","#9900ff","#7f5701","#016699","#fc6e6e","#fe63c2","#00f3ff","#ffd702")
mp<-NULL #定义一个空的地图
# 注意： borders函数中的colour是地图国家边界线的颜色,fill是国家的填充颜色
mapworld<-borders("world",colour = "#dedfe0",fill="#dedfe0") #绘制基本地图
mpvoid<-ggplot()+mapworld + ylim(-55,90)+theme_void()
mpvoid
mp<-mpvoid+geom_point(data=df,aes(x=df$Longitude,y=df$Latitude,fill = df$TreeValidatedGroupbySubspecies
),shape=21,alpha=0.9,size=2)+
  scale_fill_manual(values = colB)+
  theme(legend.position = 'none')
mp
# ggsave(mp,filename = "~/Documents/test.pdf", height = 4,width = 10)
ggsave(mp,filename = "~/Documents/test.pdf", height = 2.76 ,width = 6.89)

```
### map group by subspecies- 去除圆点外的黑圈

```{r}
library(maps)
library(maptools)
#dataFile <- c("data/taxa_InfoDB.txt")
dataFile <- c("/Users/Aoyue/project/wheatVMapII/003_dataAnalysis/zz_rProject/R4VMap2Figs/data/taxa_InfoDB.txt")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
head(df)
levels(df$TreeValidatedGroupbySubspecies)
colB <- c("#87cef9","#9900ff","#7f5701","#016699","#fc6e6e","#fe63c2","#00f3ff","#ffd702")
mp<-NULL #定义一个空的地图
# 注意： borders函数中的colour是地图国家边界线的颜色,fill是国家的填充颜色
mapworld<-borders("world",colour = "#dedfe0",fill="#dedfe0") #绘制基本地图
mpvoid<-ggplot()+mapworld + ylim(-55,90)+theme_void()
mpvoid
mp<-mpvoid+geom_point(data=df,aes(x=df$Longitude,y=df$Latitude,color = df$TreeValidatedGroupbySubspecies
),alpha=0.7,size=1)+
  scale_color_manual(values = colB)+
  theme(legend.position = 'none')
mp
# ggsave(mp,filename = "~/Documents/test.pdf", height = 4,width = 10)
# ggsave(mp,filename = "~/Documents/test.pdf", height = 2.76 ,width = 6.89)
ggsave(mp,filename = "~/Documents/test.png", height = 2.76 ,width = 6.89)

```

### map group by subspecies- 地图白色背景

```{r}
library(maps)
library(maptools)
#dataFile <- c("data/taxa_InfoDB.txt")
dataFile <- c("/Users/Aoyue/project/wheatVMapII/003_dataAnalysis/zz_rProject/R4VMap2Figs/data/taxa_InfoDB.txt")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
head(df)
levels(df$TreeValidatedGroupbySubspecies)
colB <- c("#87cef9","#9900ff","#7f5701","#016699","#fc6e6e","#fe63c2","#00f3ff","#ffd702")
mp<-NULL #定义一个空的地图
# 注意： borders函数中的colour是地图国家边界线的颜色,fill是国家的填充颜色
# mapworld<-borders("world",colour = "#dedfe0",fill="#dedfe0") #绘制基本地图
# fcfcfc
mapworld<-borders("world",colour = "#f6f6f6",fill="#f6f6f6") #绘制基本地图， 白色背景
mpvoid<-ggplot()+mapworld + ylim(-55,90)+theme_void()
mpvoid
mp<-mpvoid+geom_point(data=df,aes(x=df$Longitude,y=df$Latitude,color = df$TreeValidatedGroupbySubspecies
),alpha=0.7,size=1)+
  scale_color_manual(values = colB)+
  theme(legend.position = 'none')
mp
# ggsave(mp,filename = "~/Documents/test.pdf", height = 4,width = 10)
ggsave(mp,filename = "~/Documents/test.pdf", height = 2.76 ,width = 6.89)
# ggsave(mp,filename = "~/Documents/test.png", height = 2.76 ,width = 6.89)

```



### Map by sample size and color (rworldmap)

```{r}
library(rworldmap)
library(viridis)
dataFile <- c("/Users/Aoyue/project/wheatVMapII/003_dataAnalysis/map/002_sourceforMap/005_countCase_allVMapII.txt")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
df <- df %>% filter(!df$region == "NA") %>% 
  rename(Country = region) %>% 
  mutate(Country=recode(Country,`UnitedKingdom` = 'UK'
                       ,`Indian-kashmir`='India'
                       ,`SaudiArabia`='Saudi Arabia'
                       ,`Soviet Union`='Russia'
                       ,`America`="USA"
                       ,`UnitedStates`="USA"
                       ,`SouthAfrica` = "South Africa"
                       ,`CzechRepoublic`="Czech Republic"))
                                         
  
sPDF <- joinCountryData2Map(df,joinCode = "NAME",nameJoinColumn = "Country",verbose = T)                            

par(mai=c(0,0,0.2,0),xaxs="i",yaxs="i")
colB <- viridis::viridis(5,option = "D")
p <- mapCountryData(sPDF, nameColumnToPlot="Count"
                    ,catMethod=c(1,20,40,60,80,88)
                    ,colourPalette = colB
                    )  

p

min(df$Count)

```

## ==========================
## FigS: world map by sample size
### all 643 taxa
```{r}
################################# ##
#                                             #
# 整个VMapII的地理分布及每个国家的采样数量多少
#                                             #
################################# ##
library(tidyverse)
library(sf)
library(rvest)
library(stringr)
library(scales)
library(viridis)
dataFile <- c("data/fig1/002_sourceforMap/005_countCase_allVMapII.txt")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
head(df)
df <- subset(df,!df$region == "NA")
# levels(df$region)
# df <- droplevels(df)
df %>% glimpse()
map.world <- map_data('world')
map.world$region <- as.factor(map.world$region)
# write.table(map.world,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t") 
#### 两批数据的结合，说明在我的表中，有和大表中不一样的国家名字
dplyr::anti_join(df, map.world, by = c('region'))
### 查看在source数据中，国家的名字是怎样描述的，结果发现 英国是UK
map.world %>%
  dplyr::group_by(region) %>%
  dplyr::summarise() %>%
  print(n = Inf)
# write.table(map.world,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t") 
### 将不一样的进行编码，使其保持一致
df <- df %>% dplyr::mutate(region=recode(region,`UnitedKingdom` = 'UK'
                                         ,`Indian-kashmir`='India'
                                         ,`SaudiArabia`='Saudi Arabia'
                                         ,`Soviet Union`='Russia'
                                         ,`America`="USA"
                                         ,`UnitedStates`="USA"
                                         ,`CzechRepoublic`="Czech Republic"))
### 合并2个表格
map.df <- dplyr::left_join(map.world, df, by = c('region')) 
###########
###########

dataFile <- c("/Users/Aoyue/project/wheatVMapII/003_dataAnalysis/zz_rProject/R4VMap2Figs/data/taxa_InfoDB.txt")
dfnew <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)

p <- ggplot() +
  geom_polygon(data = map.df,mapping = aes(x = long, y = lat, group = group,fill = Count))+
  geom_point(data=dfnew,aes(x=Longitude,y=Latitude),fill = "red",color = "red", shape=21,alpha=0.5,size=1)+
  # scale_y_continuous(limits = c(-60,83))+
  # scale_fill_gradientn(colours = c('#461863','#404E88','#2A8A8C','#7FD157','#F9E53F')
  #                      ,values = scales::rescale(c(3,6,9,12))
  #                      ,labels = comma
  #                      ,breaks = c(3,6,9,12)
  # ) +
  scale_fill_gradientn(colours = c('#461863','#404E88','#2A8A8C','#7FD157','#F9E53F')
                       # ,values = scales::rescale(c(3,6,9,12))
                       # ,labels = comma
                       # ,breaks = c(3,6,9,12)
  ) +
# scale_color_viridis(option = "D") +  #Viridis
# 
#   scale_fill_(colours = c('#461863','#404E88','#2A8A8C','#7FD157','#F9E53F')
#                        # ,values = scales::rescale(c(3,6,9,12))
#                        # ,labels = comma
#                        # ,breaks = c(3,6,9,12)
#   ) +
  guides(fill = guide_legend(reverse = T)) +
  labs(fill = 'Sample count'
       # ,title = 'Geographical distribution of VMap II collection'
       # ,subtitle = 'VMap II collection'
       ,x = NULL
       ,y = NULL) +
  theme(text = element_text( 
    # color = '#EEEEEE'
    color = 'black'
    # family = 'Gill Sans'
  )
  ,plot.title = element_text(size = 12)
  ,plot.subtitle = element_text(size = 12)
  ,axis.ticks = element_blank()
  ,axis.text = element_blank()
  ,panel.grid = element_blank()
  # ,panel.background = element_rect(fill = '#333333') ## 地图外的背景色
  ,panel.background = element_rect(fill = 'white')
  ,plot.background = element_rect(fill = '#333333') ## 标题的颜色
  # ,plot.background = element_rect(fill = 'white')
  ,legend.position = c(.15,.5)
  ,legend.background = element_blank()
  ,legend.key = element_blank()
  ) +
  annotate(geom = 'text'
           ,label = ''
           ,x = 18, y = -55
           ,size = 3
           # ,family = 'Gill Sans'
           ,color = '#CCCCCC'
           ,hjust = 'left'
  )

p
ggsave(p,filename = "/Users/Aoyue/Documents/test.pdf",height = 5,width = 10)

```
### Ae.tauschii
```{r}
################################# ##
#                               #
# 只画 tauschii 的个体
#                               #
################################# ##
##### 先画  landrace 的国家分布
library(tidyverse)
library(sf)
library(rvest)
library(stringr)
library(scales)
#library(viridis)
dataFile <- c("/Users/Aoyue/project/wheatVMapII/003_dataAnalysis/map/002_sourceforMap/004_country_subspecies_addLandracebyContinent_20020915.txt")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
head(df)
# df <- dplyr::arrange(df, desc(Landrace))
df <- subset(df,!df$Ae.tauschii == 0 & (!df$region=="Soviet Union") & (!df$region=="Russia"))
# levels(df$region)
df <- droplevels(df)
df %>% glimpse()
nrow(df)
map.world <- map_data('world')
map.world$region <- as.factor(map.world$region)
# write.table(map.world,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t") 
#### 两批数据的结合，说明在我的表中，有和大表中不一样的国家名字
dplyr::anti_join(df, map.world, by = c('region'))
### 查看在source数据中，国家的名字是怎样描述的，结果发现 英国是UK
map.world %>%
  dplyr::group_by(region) %>%
  dplyr::summarise() %>%
  print(n = Inf)
# write.table(map.world,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t") 
### 将不一样的进行编码，使其保持一致
df <- df %>% dplyr::mutate(region=recode(region,`UnitedKingdom` = 'UK'
                                         ,`Indian-kashmir`='India'
                                         ,`SaudiArabia`='Saudi Arabia'
                                         ,`SovietUnion`='Russia'))
### 合并2个表格
map.df <- dplyr::left_join(map.world, df, by = c('region')) 
write.table(map.df,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t")
max(map.df$lat)
min(map.df$lat)
###########
###########

dataFile <- c("data/taxa_InfoDB.txt")
dfnew <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
dfnew <- dfnew %>% filter(GenomeType == "DD")

p <- ggplot() +
  geom_polygon(data = map.df, mapping = aes( x = long, y = lat, group = group,fill = Ae.tauschii))+
  geom_point(data=dfnew,aes(x=Longitude,y=Latitude),fill = "red",color = "red", shape=21,alpha=0.5,size=1)+

  # scale_y_continuous(limits = c(-60,83))+
  # scale_fill_gradientn(colours = c('#461863','#404E88','#2A8A8C','#7FD157','#F9E53F')
  #                      ,values = scales::rescale(c(3,6,9,12))
  #                      ,labels = comma
  #                      ,breaks = c(3,6,9,12)
  # ) +
  scale_fill_gradientn(colours = c('#461863','#404E88','#2A8A8C','#7FD157','#F9E53F')
                       # ,values = scales::rescale(c(3,6,9,12))
                       # ,labels = comma
                       # ,breaks = c(3,6,9,12)
  ) +
  guides(fill = guide_legend(reverse = T)) +
  labs(fill = 'Sample count'
       # ,title = 'Geographical distribution of Ae.tauschii'
       # ,subtitle = 'VMap II collection'
       ,x = NULL
       ,y = NULL) +
  theme(text = element_text( 
    # color = '#EEEEEE'
    color = 'black'
    # family = 'Gill Sans'
  )
  ,plot.title = element_text(size = 12)
  ,plot.subtitle = element_text(size = 12)
  ,axis.ticks = element_blank()
  ,axis.text = element_blank()
  ,panel.grid = element_blank()
  # ,panel.background = element_rect(fill = '#333333') ## 地图外的背景色
  ,panel.background = element_rect(fill = 'white')
  # ,plot.background = element_rect(fill = '#333333') ## 标题的颜色
  ,plot.background = element_rect(fill = 'white')
  ,legend.position = c(.15,.5)
  ,legend.background = element_blank()
  ,legend.key = element_blank()
  ) +
  annotate(geom = 'text'
           ,label = ''
           ,x = 18, y = -55
           ,size = 3
           # ,family = 'Gill Sans'
           ,color = '#CCCCCC'
           ,hjust = 'left'
  )

p
ggsave(p,filename = "~/Documents/test.pdf",height = 5,width = 10)

```
### Wild emmer
```{r}
################################# ##
#                               #
# 只画 Wild emmer 的个体
#                               #
################################# ##
library(tidyverse)
library(sf)
library(rvest)
library(stringr)
library(scales)
#library(viridis)
dataFile <- c("/Users/Aoyue/project/wheatVMapII/003_dataAnalysis/map/002_sourceforMap/004_country_subspecies_addLandracebyContinent_20020915.txt")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
head(df)
# df <- dplyr::arrange(df, desc(Landrace))
df <- subset(df,!df$Wild_emmer == 0)
# levels(df$region)
# df <- droplevels(df)
df %>% glimpse()
nrow(df)
map.world <- map_data('world')
map.world$region <- as.factor(map.world$region)
# write.table(map.world,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t") 
#### 两批数据的结合，说明在我的表中，有和大表中不一样的国家名字
dplyr::anti_join(df, map.world, by = c('region'))
### 查看在source数据中，国家的名字是怎样描述的，结果发现 英国是UK
map.world %>%
  dplyr::group_by(region) %>%
  dplyr::summarise() %>%
  print(n = Inf)
# write.table(map.world,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t") 
### 将不一样的进行编码，使其保持一致
df <- df %>% dplyr::mutate(region=recode(region,`UnitedKingdom` = 'UK'
                                         ,`Indian-kashmir`='India'
                                         ,`SaudiArabia`='Saudi Arabia'
                                         ,`SovietUnion`='Russia'
                           ,`America`="USA"
                           ,`CzechRepoublic`="Czech Republic"))
### 合并2个表格
map.df <- dplyr::left_join(map.world, df, by = c('region')) 
###########
###########
dataFile <- c("data/taxa_InfoDB.txt")
dfnew <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
dfnew <- dfnew %>% filter(TreeValidatedGroupbySubspecies == "Wild_emmer")

p <- ggplot() +
  geom_polygon(data = map.df, mapping = aes( x = long, y = lat, group = group,fill = Wild_emmer))+
  geom_point(data=dfnew,aes(x=Longitude,y=Latitude),fill = "red",color = "red", shape=21,alpha=0.5,size=1)+

  # scale_y_continuous(limits = c(-60,83))+
  # scale_fill_gradientn(colours = c('#461863','#404E88','#2A8A8C','#7FD157','#F9E53F')
  #                      ,values = scales::rescale(c(3,6,9,12))
  #                      ,labels = comma
  #                      ,breaks = c(3,6,9,12)
  # ) +
  scale_fill_gradientn(colours = c('#461863','#404E88','#2A8A8C','#7FD157','#F9E53F')
                       # ,values = scales::rescale(c(3,6,9,12))
                       # ,labels = comma
                       # ,breaks = c(3,6,9,12)
  ) +
  guides(fill = guide_legend(reverse = T)) +
  labs(fill = 'Sample count'
       # ,title = 'Geographical distribution of wild emmer'
       # ,subtitle = 'VMap II collection'
       ,x = NULL
       ,y = NULL) +
  theme(text = element_text( 
    # color = '#EEEEEE'
    color = 'black'
    # family = 'Gill Sans'
  )
  ,plot.title = element_text(size = 12)
  ,plot.subtitle = element_text(size = 12)
  ,axis.ticks = element_blank()
  ,axis.text = element_blank()
  ,panel.grid = element_blank()
  # ,panel.background = element_rect(fill = '#333333') ## 地图外的背景色
  ,panel.background = element_rect(fill = 'white')
  # ,plot.background = element_rect(fill = '#333333') ## 标题的颜色
  ,plot.background = element_rect(fill = 'white')
  ,legend.position = c(.15,.5)
  ,legend.background = element_blank()
  ,legend.key = element_blank()
  ) +
  annotate(geom = 'text'
           ,label = ''
           ,x = 18, y = -55
           ,size = 3
           # ,family = 'Gill Sans'
           ,color = '#CCCCCC'
           ,hjust = 'left'
  )

p
ggsave(p,filename = "/Users/Aoyue/Documents/test.pdf",height = 5,width = 10)

```

### Domesticated emmer
```{r}
################################# ##
#                               #
# 只画 domesticated emmer 的个体
#                               #
################################# ##
library(tidyverse)
library(sf)
library(rvest)
library(stringr)
library(scales)
#library(viridis)
dataFile <- c("data/fig1/002_sourceforMap/004_country_subspecies_addLandracebyContinent_20020915.txt")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
head(df)
# df <- dplyr::arrange(df, desc(Landrace))
df <- subset(df,!df$Domesticated_emmer == 0)
# levels(df$region)
# df <- droplevels(df)
df %>% glimpse()
nrow(df)
map.world <- map_data('world')
map.world$region <- as.factor(map.world$region)
# write.table(map.world,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t") 
#### 两批数据的结合，说明在我的表中，有和大表中不一样的国家名字
dplyr::anti_join(df, map.world, by = c('region'))
### 查看在source数据中，国家的名字是怎样描述的，结果发现 英国是UK
map.world %>%
  dplyr::group_by(region) %>%
  dplyr::summarise() %>%
  print(n = Inf)
# write.table(map.world,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t") 
### 将不一样的进行编码，使其保持一致
df <- df %>% dplyr::mutate(region=recode(region,`UnitedKingdom` = 'UK'
                                         ,`Indian-kashmir`='India'
                                         ,`SaudiArabia`='Saudi Arabia'
                                         ,`SovietUnion`='Russia'
                                         ,`America`="USA"
                                         ,`CzechRepoublic`="Czech Republic"))
### 合并2个表格
map.df <- dplyr::left_join(map.world, df, by = c('region')) 
###########
###########

dataFile <- c("data/taxa_InfoDB.txt")
dfnew <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
dfnew <- dfnew %>% filter(TreeValidatedGroupbySubspecies == "Domesticated_emmer")

p <- ggplot() +
  geom_polygon(data = map.df, mapping = aes( x = long, y = lat, group = group,fill = Domesticated_emmer))+
  geom_point(data=dfnew,aes(x=Longitude,y=Latitude),fill = "red",color = "red", shape=21,alpha=0.5,size=1)+

  # scale_y_continuous(limits = c(-60,83))+
  # scale_fill_gradientn(colours = c('#461863','#404E88','#2A8A8C','#7FD157','#F9E53F')
  #                      ,values = scales::rescale(c(3,6,9,12))
  #                      ,labels = comma
  #                      ,breaks = c(3,6,9,12)
  # ) +
  scale_fill_gradientn(colours = c('#461863','#404E88','#2A8A8C','#7FD157','#F9E53F')
                       ,values = scales::rescale(c(1,4,7,10,13))
                       ,labels = comma
                       ,breaks = c(1,4,7,10,13)
  ) +
  # scale_fill_viridis()+
  guides(fill = guide_legend(reverse = T)) +
  labs(fill = 'Sample count'
       # ,title = 'Geographical distribution of domesticated emmer'
       # ,subtitle = 'VMap II collection'
       ,x = NULL
       ,y = NULL) +
  theme(text = element_text( 
    # color = '#EEEEEE'
    color = 'black'
    # family = 'Gill Sans'
  )
  ,plot.title = element_text(size = 12)
  ,plot.subtitle = element_text(size = 12)
  ,axis.ticks = element_blank()
  ,axis.text = element_blank()
  ,panel.grid = element_blank()
  # ,panel.background = element_rect(fill = '#333333') ## 地图外的背景色
  ,panel.background = element_rect(fill = 'white')
  # ,plot.background = element_rect(fill = '#333333') ## 标题的颜色
  ,plot.background = element_rect(fill = 'white')
  ,legend.position = c(.15,.5)
  ,legend.background = element_blank()
  ,legend.key = element_blank()
  ) +
  annotate(geom = 'text'
           ,label = ''
           ,x = 18, y = -55
           ,size = 3
           # ,family = 'Gill Sans'
           ,color = '#CCCCCC'
           ,hjust = 'left'
  )

p
ggsave(p,filename = "/Users/Aoyue/Documents/test.pdf",height = 5,width = 10)
```

### Free-thresging tetraploids
```{r}
##### 先画free-threshing tetraploid的国家分布
library(tidyverse)
library(sf)
library(rvest)
library(stringr)
library(scales)
#library(viridis)
dataFile <- c("/Users/Aoyue/project/wheatVMapII/003_dataAnalysis/map/002_sourceforMap/001_VMapII_countryCountbySubspecies.txt")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
df <- df %>% dplyr::rename(country=sum)
head(df)
df <- dplyr::arrange(df, desc(Free_threshing_tetraploid))
df <- df[-1,]
df <- plyr::mutate(df,Rank=c(1:dim(df)[1]))
df <- subset(df,!df$Free_threshing_tetraploid == 0)
df %>% glimpse()
nrow(df)
map.world <- map_data('world')
map.world$region <- as.factor(map.world$region)
# write.table(map.world,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t") 
#### 两批数据的结合，说明在我的表中，有和大表中不一样的国家名字
dplyr::anti_join(df, map.world, by = c('country' = 'region'))
### 查看在source数据中，国家的名字是怎样描述的，结果发现 英国是UK
map.world %>%
  dplyr::group_by(region) %>%
  dplyr::summarise() %>%
  print(n = Inf)
# write.table(map.world,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t") 
### 将不一样的进行编码，使其保持一致
df <- df %>% dplyr::mutate(country=recode(country,`UnitedKingdom` = 'UK'))
### 合并2个表格
map.df <- dplyr::left_join(map.world, df, by = c('region' = 'country')) 
write.table(map.df,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t")
max(map.df$lat)
min(map.df$lat)
###########
###########
dataFile <- c("data/taxa_InfoDB.txt")
dfnew <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
dfnew <- dfnew %>% filter(TreeValidatedGroupbySubspecies == "Free_threshing_tetraploid")

p <- ggplot() +
  geom_polygon(data = map.df, mapping = aes( x = long, y = lat, group = group,fill = Free_threshing_tetraploid))+
  geom_point(data=dfnew,aes(x=Longitude,y=Latitude),fill = "red",color = "red", shape=21,alpha=0.5,size=1)+

  # scale_y_continuous(limits = c(-60,83))+
# scale_fill_gradientn(colours = c('#461863','#404E88','#2A8A8C','#7FD157','#F9E53F')
#                      ,values = scales::rescale(c(3,6,9,12))
#                      ,labels = comma
#                      ,breaks = c(3,6,9,12)
# ) +
  scale_fill_gradientn(colours = c('#461863','#404E88','#2A8A8C','#7FD157','#F9E53F')
                       # ,values = scales::rescale(c(3,6,9,12))
                       # ,labels = comma
                       # ,breaks = c(3,6,9,12)
  ) +
  guides(fill = guide_legend(reverse = T)) +
  labs(fill = 'Sample count'
       # ,title = 'Geographical distribution of free-threshing tetraploids'
       # ,subtitsle = 'VMap II collection'
       ,x = NULL
       ,y = NULL) +
  theme(text = element_text( color = 'black'
                             # ,color = '#EEEEEE'
                             # family = 'Gill Sans'
                             )
        ,plot.title = element_text(size = 12)
        ,plot.subtitle = element_text(size = 12)
        ,axis.ticks = element_blank()
        ,axis.text = element_blank()
        ,panel.grid = element_blank()
        # ,panel.background = element_rect(fill = '#333333')
        # ,plot.background = element_rect(fill = '#333333')
        ,panel.background = element_rect(fill = 'white')
        ,plot.background = element_rect(fill = 'white')
        ,legend.position = c(.15,.5)
        ,legend.background = element_blank()
        ,legend.key = element_blank()
  ) +
  annotate(geom = 'text'
           ,label = ''
           ,x = 18, y = -55
           ,size = 3
           # ,family = 'Gill Sans'
           ,color = '#CCCCCC'
           ,hjust = 'left'
  )

p
ggsave(p,filename = "/Users/Aoyue/Documents/test.pdf",height = 5,width = 10)
```

### Landrace
```{r}
##### 先画  landrace 的国家分布
library(tidyverse)
library(sf)
library(rvest)
library(stringr)
library(scales)
#library(viridis)
dataFile <- c("/Users/Aoyue/project/wheatVMapII/003_dataAnalysis/map/002_sourceforMap/004_country_subspecies_addLandracebyContinent_20020915.txt")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
head(df)
# df <- dplyr::arrange(df, desc(Landrace))
df <- df %>% filter(!Landrace==0)
df %>% glimpse()
nrow(df)
map.world <- map_data('world')
map.world$region <- as.factor(map.world$region)
# write.table(map.world,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t") 
#### 两批数据的结合，说明在我的表中，有和大表中不一样的国家名字
dplyr::anti_join(df, map.world, by = c('region'))
### 查看在source数据中，国家的名字是怎样描述的，结果发现 英国是UK
map.world %>%
  dplyr::group_by(region) %>%
  dplyr::summarise() %>%
  print(n = Inf)
# write.table(map.world,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t") 
### 将不一样的进行编码，使其保持一致
df <- df %>% dplyr::mutate(region=recode(region,`UnitedKingdom` = 'UK'
                                          ,`Indian-kashmir`='India'
                                          ,`SaudiArabia`='Saudi Arabia'
                                          ,`SovietUnion`='Russia'))
### 合并2个表格
map.df <- dplyr::left_join(map.world, df, by = c('region')) 
write.table(map.df,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t")
max(map.df$lat)
min(map.df$lat)
###########
###########

dataFile <- c("data/taxa_InfoDB.txt")
dfnew <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
dfnew <- dfnew %>% filter(TreeValidatedGroupbySubspecies == "Landrace")

p <- ggplot() +
  # geom_polygon(aes(fill = Landrace,color=LRbyContinent))+
  geom_polygon(data = map.df, mapping = aes( x = long, y = lat, group = group,fill = Landrace))+
geom_point(data=dfnew,aes(x=Longitude,y=Latitude),fill = "red",color = "red", shape=21,alpha=0.5,size=1)+

  # geom_point(aes(size=Landrace,color = LRbyContinent),stroke=F, alpha=0.7)+
  # scale_y_continuous(limits = c(-60,83))+
  # scale_fill_gradientn(colours = c('#461863','#404E88','#2A8A8C','#7FD157','#F9E53F')
  #                      ,values = scales::rescale(c(3,6,9,12))
  #                      ,labels = comma
  #                      ,breaks = c(3,6,9,12)
  # ) +
  scale_fill_gradientn(colours = c('#461863','#404E88','#2A8A8C','#7FD157','#F9E53F')
                       # ,values = scales::rescale(c(3,6,9,12))
                       # ,labels = comma
                       # ,breaks = c(3,6,9,12)
  ) +
  guides(fill = guide_legend(reverse = T)) +
  labs(fill = 'Sample count'
       # ,title = 'Geographical distribution of landrace'
       # ,subtitle = 'VMap II collection'
       ,x = NULL
       ,y = NULL) +
  theme(text = element_text( 
                             # color = '#EEEEEE'
                             color = 'black'
                             # family = 'Gill Sans'
  )
  ,plot.title = element_text(size = 12)
  ,plot.subtitle = element_text(size = 12)
  ,axis.ticks = element_blank()
  ,axis.text = element_blank()
  ,panel.grid = element_blank()
  # ,panel.background = element_rect(fill = '#333333') ## 地图外的背景色
  ,panel.background = element_rect(fill = 'white')
  # ,plot.background = element_rect(fill = '#333333') ## 标题的颜色
  ,plot.background = element_rect(fill = 'white')
  ,legend.position = c(.15,.5)
  ,legend.background = element_blank()
  ,legend.key = element_blank()
  ) +
  annotate(geom = 'text'
           ,label = ''
           ,x = 18, y = -55
           ,size = 3
           # ,family = 'Gill Sans'
           ,color = '#CCCCCC'
           ,hjust = 'left'
  )


p
ggsave(p,filename = "/Users/Aoyue/Documents/test.pdf",height = 5,width = 10)

```

### Cultivar
```{r}
################################# ##
#                               #
# 只画 Cultivar 的个体
#                               #
################################# ##
##### 先画  landrace 的国家分布
library(tidyverse)
library(sf)
library(rvest)
library(stringr)
library(scales)
#library(viridis)
dataFile <- c("/Users/Aoyue/project/wheatVMapII/003_dataAnalysis/map/002_sourceforMap/004_country_subspecies_addLandracebyContinent_20020915.txt")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
head(df)
# df <- dplyr::arrange(df, desc(Landrace))
df <- subset(df,!df$Cultivar == 0)
# levels(df$region)
# df <- droplevels(df)
df %>% glimpse()
nrow(df)
map.world <- map_data('world')
map.world$region <- as.factor(map.world$region)
# write.table(map.world,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t") 
#### 两批数据的结合，说明在我的表中，有和大表中不一样的国家名字
dplyr::anti_join(df, map.world, by = c('region'))
### 查看在source数据中，国家的名字是怎样描述的，结果发现 英国是UK
map.world %>%
  dplyr::group_by(region) %>%
  dplyr::summarise() %>%
  print(n = Inf)
# write.table(map.world,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t") 
### 将不一样的进行编码，使其保持一致
df <- df %>% dplyr::mutate(region=recode(region,`UnitedKingdom` = 'UK'
                                         ,`Indian-kashmir`='India'
                                         ,`SaudiArabia`='Saudi Arabia'
                                         ,`SovietUnion`='Russia'
                           ,`America`="USA"
                           ,`CzechRepoublic`="Czech Republic"))
### 合并2个表格
map.df <- dplyr::left_join(map.world, df, by = c('region')) 
write.table(map.df,file="/Users/Aoyue/Documents/value.txt",quote=F,col.name=T,row.names=F,sep = "\t")
max(map.df$lat)
min(map.df$lat)
###########
###########
dataFile <- c("data/taxa_InfoDB.txt")
dfnew <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
dfnew <- dfnew %>% filter(TreeValidatedGroupbySubspecies == "Cultivar")

p <- ggplot() +
  geom_polygon(data = map.df, mapping = aes( x = long, y = lat, group = group,fill = Cultivar))+
  geom_point(data=dfnew,aes(x=Longitude,y=Latitude),fill = "red",color = "red", shape=21,alpha=0.5,size=1)+
  # scale_y_continuous(limits = c(-60,83))+
  # scale_fill_gradientn(colours = c('#461863','#404E88','#2A8A8C','#7FD157','#F9E53F')
  #                      ,values = scales::rescale(c(3,6,9,12))
  #                      ,labels = comma
  #                      ,breaks = c(3,6,9,12)
  # ) +
  scale_fill_gradientn(colours = c('#461863','#404E88','#2A8A8C','#7FD157','#F9E53F')
                       # ,values = scales::rescale(c(3,6,9,12))
                       # ,labels = comma
                       # ,breaks = c(3,6,9,12)
  ) +
  guides(fill = guide_legend(reverse = T)) +
  labs(fill = 'Sample count'
       # ,title = 'Geographical distribution of cultivar'
       # ,subtitle = 'VMap II collection'
       ,x = NULL
       ,y = NULL) +
  theme(text = element_text( 
    # color = '#EEEEEE'
    color = 'black'
    # family = 'Gill Sans'
  )
  ,plot.title = element_text(size = 12)
  ,plot.subtitle = element_text(size = 12)
  ,axis.ticks = element_blank()
  ,axis.text = element_blank()
  ,panel.grid = element_blank()
  # ,panel.background = element_rect(fill = '#333333') ## 地图外的背景色
  ,panel.background = element_rect(fill = 'white')
  # ,plot.background = element_rect(fill = '#333333') ## 标题的颜色
  ,plot.background = element_rect(fill = 'white')
  ,legend.position = c(.15,.5)
  ,legend.background = element_blank()
  ,legend.key = element_blank()
  ) +
  annotate(geom = 'text'
           ,label = ''
           ,x = 18, y = -55
           ,size = 3
           # ,family = 'Gill Sans'
           ,color = '#CCCCCC'
           ,hjust = 'left'
  )

p
ggsave(p,filename = "/Users/Aoyue/Documents/test.pdf",height = 5,width = 10)
```







## ======================
## Fig.1\|PCA

### PCA all 642

```{r}
library(factoextra)
library(FactoMineR)
dataFile <- c("data/fig1/001_matrix.txt.gz")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=1)
df1 <- df[,c(-645:-647)]
## the data are scaled to unit variance before the analysis
# PCA(df1, scale.unit = TRUE, ncp = 10, graph = TRUE)
df.pca <- PCA(df[,c(-645:-647)],graph = T) 

#df.pca$eig

p <- fviz_pca_ind(df.pca,
                  # col.ind = "cos2",
                  # gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07","black","yellow","blue","green"),
                  # repel = TRUE,
                  geom.ind = "point", ## 个体用点表示
                  pointshape = 21,
                  fill = df$GenomeType,
                  # pointsize = df$Pi,
                  # col.ind = df$Subspecies, # color by groups
                  # fill.ind = df$Subspecies,
                  ## 倍性的颜色
                  palette = c("#ffd702",'#fc6e6e','#87cef9')
                  # palette = c("#9900ff", "#7f5701", "#016699", "#20B2AA",  "#fc6e6e","#006400","#ffd702","black","red")
                  # addEllipses = T, # Concentration ellipses
                  # legend.title = "Groups"
) + 
   theme(panel.background = element_rect(size = 0.7, colour = 'black',fill = 'white'),panel.grid.major = element_blank(), panel.grid.minor = element_blank(),text = element_text(size = 12),
                  legend.position = 'none')+
  xlab("PC1 (71%)")+ylab("PC2 (11.2%)")+ggtitle("")

p
# ggsave(p,filename = "/Users/Aoyue/Documents/test.pdf",height = 2.57,width = 2.57)
ggsave(p,filename = "/Users/Aoyue/Documents/test.pdf",height = 3,width = 3*16/9)

```

### PCA AB sub by subspecies

```{r}
library(factoextra)
library(FactoMineR)
### important data
df <- read.table("data/fig1/006_matrix_ABsub.txt.gz",header = T,sep = "\t",row.names = 1) # 第一列是taxa
#colnames(df)
c1 <- which(colnames(df) == 'GenomeType')
c2 <- which(colnames(df) == 'Part_Continent')
c3 <- which(colnames(df) == 'Continent_forTree')
c4 <- which(colnames(df) == 'IndexforMutationBurden')
c5 <- which(colnames(df) == 'Subspecies')
c6 <- which(colnames(df) == 'Continent_by7')

df.pca <- PCA(df[,-c(c1,c2,c3,c4,c5,c6)],graph = F)
### 提取变异解释度并合并数据
variance1 <-  paste(round(df.pca$eig[1,3],2),"%",sep="") 
variance2 <-  paste(round(df.pca$eig[2,3] - df.pca$eig[1,3],2),"%",sep="")
dfpca <- as.data.frame(df.pca$ind$coord)
df <- cbind(df,dfpca)
### start to plot
levels(as.factor(df$Subspecies) )
df$Subspecies <- factor(df$Subspecies,levels = c("Wild_emmer","Domesticated_emmer","Free_threshing_tetraploid","OtherTetraploid","Landrace","Cultivar","OtherHexaploid"))
colB <- c('#ffd702','#7f5701','#016699','#00f3ff','#fc6e6e','#9900ff','#fe63c2')
p <- ggplot(df,aes(x=Dim.1,y=Dim.2,fill=Subspecies, shape = Continent_forTree))+
  # geom_point(aes(color=Subspecies),alpha=0.5,size=2)+
  geom_point(alpha=0.8,size=2,color="gray")+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  scale_shape_manual(values=c(23, 22,21,24,25), name="Continent")+
  # scale_shape_manual(values=c(15, 16,17,18,19), name="Continent")+
  # scale_color_manual(values = colB,name="Genetic group")+
  scale_fill_manual(values = colB,name="Genetic group")+
  labs(x=paste("PC1 ","(",variance1,")",sep = ""), y=paste("PC2 ","(",variance2,")",sep = ""))+
  theme(
    panel.background = element_blank(),
    panel.border = element_rect(colour = "black", fill=NA, size=0.7)
    ,legend.position = 'none'
    ,text = element_text(size = 12))
  
p
# ggsave(p,filename = "~/Documents/test.pdf",height = 2,width = 3.6)
ggsave(p,filename = "~/Documents/test.png",height = 2,width = 3.6)

# ggsave(p,filename = "~/Documents/test.pdf",height = 3,width = 4)

# ggsave(p,filename = "~/Documents/test.pdf",height = 3,width = 3)
```


### PCA D sub by subspecies

```{r}
library(factoextra)
library(FactoMineR)
### important data
df <- read.table("data/fig1/002_matrix_Dsub.txt.gz",header = T,sep = "\t",row.names = 1) # 第一列是taxa
#colnames(df)
c1 <- which(colnames(df) == 'GenomeType')
c2 <- which(colnames(df) == 'Part_Continent')
c3 <- which(colnames(df) == 'Continent_forTree')
c4 <- which(colnames(df) == 'IndexforMutationBurden')
c5 <- which(colnames(df) == 'Subspecies')
c6 <- which(colnames(df) == 'Continent_by7')

df.pca <- PCA(df[,-c(c1,c2,c3,c4,c5,c6)],graph = F)
### 提取变异解释度并合并数据
variance1 <-  paste(round(df.pca$eig[1,3],2),"%",sep="") 
variance2 <-  paste(round(df.pca$eig[2,3] - df.pca$eig[1,3],2),"%",sep="")
dfpca <- as.data.frame(df.pca$ind$coord)
df <- cbind(df,dfpca)
### start to plot
levels(as.factor(df$Subspecies) )
df$Subspecies <- factor(df$Subspecies,levels = c("Ae.tauschii","Landrace","Cultivar","OtherHexaploid"))
colB <- c("#87cef9",'#fc6e6e','#9900ff','#fe63c2')
p <- ggplot(df,aes(x=Dim.1,y=Dim.2,fill=Subspecies, shape = Continent_forTree))+
  # geom_point(aes(color=Subspecies),alpha=0.5,size=2)+
  geom_point(alpha=0.8,size=2,color="gray")+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  scale_shape_manual(values=c(23, 22,21,24,25), name="Continent")+
  # scale_shape_manual(values=c(15, 16,17,18,19), name="Continent")+
  # scale_color_manual(values = colB,name="Genetic group")+
  scale_fill_manual(values = colB,name="Genetic group")+
  labs(x=paste("PC1 ","(",variance1,")",sep = ""), y=paste("PC2 ","(",variance2,")",sep = ""))+
  theme(
    panel.background = element_blank(),
    panel.border = element_rect(colour = "black", fill=NA, size=0.7)
    ,legend.position = 'none'
    # ,legend.key = element_blank()
    ,text = element_text(size = 12))

p
# ggsave(p,filename = "~/Documents/test.pdf",height = 2,width = 3.6)
ggsave(p,filename = "~/Documents/test.png",height = 2,width = 3.6)

# ggsave(p,filename = "~/Documents/test.pdf",height = 2,width = 4)
```



### legend

```{r}
p <- ggplot(df,aes(x=Dim.1,y=Dim.2,fill=Subspecies, shape = Continent_forTree))+
  # geom_point(aes(color=Subspecies),alpha=0.5,size=2)+
  geom_point(alpha=0.8,size=2,color="black")+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  scale_shape_manual(values=c(23, 22,21,24,25), name="Continent")+
  # scale_shape_manual(values=c(15, 16,17,18,19), name="Continent")+
  # scale_color_manual(values = colB,name="Genetic group")+
  scale_fill_manual(values = colB,name="Genetic group")+
  labs(x=paste("PC1 ","(",variance1,")",sep = ""), y=paste("PC2 ","(",variance2,")",sep = ""))+
  theme(
    panel.background = element_blank(),
    panel.border = element_rect(colour = "black", fill=NA, size=0.7)
    # ,legend.position = 'none'
    ,legend.key = element_blank()
    ,text = element_text(size = 12))

p
ggsave(p,filename = "~/Documents/test.pdf",height = 4,width = 4)
```
## ==================
## Fig.1\|PopNum

```{r}
Subspecies <- c("Ae.tauschii","Wild emmer","Domesticated emmer","Free-threshing tetraploids",
                "Other tetraploid","Landrace","Cultivar","Other hexaploid")
n <- c(36,66,52,50,19,235,66,119)
id <- rep(1,8)
df <- data.frame(id=id,Subspecies=Subspecies,n=n)
head(df)
df
colB <- c('#87cef9','#fe63c2','#9900ff','#fc6e6e','#00f3ff','#016699','#7f5701','#ffd702')
df$Subspecies <- factor(df$Subspecies,
                        levels = c( "Ae.tauschii","Other hexaploid","Cultivar","Landrace", "Other tetraploid",
                                   "Free-threshing tetraploids", "Domesticated emmer","Wild emmer"))
p <- ggplot(df,aes(x=id,y=n,fill=Subspecies))+
  geom_bar(stat="identity",alpha=0.95)+
  scale_fill_manual(values = colB)+
  coord_flip()+
  theme_void()+
  theme(legend.position = 'none')
p
ggsave(p,filename = "~/Documents/test.pdf",height = 0.5,width = 4)

```
## =====================
## Pairwise *F~ST~* and π -1

```{r}
dataFile <- c("data/005_fst_matrix_addPi_manual.txt")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
head(df)
levels(df$Group)
df$Group <- factor(df$Group,levels = c("Wild_emmer","Domesticated_emmer",
        "Free_threshing_tetraploid","Landrace","Cultivar"),ordered = TRUE)
colB <- c("#ffd702","#7f5701","#016699","#fc6e6e","#9900ff")
p <- ggplot(df,aes(x=Dim.1,y=Dim.2,fill=Group,size=Pi,shape=Sub))+
  geom_point(color='black',alpha=0.8)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  scale_shape_manual(values=c(23, 21), name="Subgenome")+
  scale_fill_manual(values = colB,name="Genetic group")+
  scale_x_continuous(limits = c(-2.7,2.8),breaks = seq(-2,2.8,1))+
  scale_y_continuous(limits = c(-2.5,2.5),breaks = seq(-2,2,1))+
  xlab("Dimension 1 (57.32%)")+ ylab("Dimension 2 (26.77%)")+
theme(
    panel.background = element_blank(),
    panel.border = element_rect(colour = "black", fill=NA, size=0.7)
    ,legend.position = 'none'
    ,text = element_text(size = 12))

p
ggsave(p,filename = "/Users/Aoyue/Documents/test.pdf",height = 3,width = 4)
```

- legend
```{r}
# ### 画图例
dataFile <- c("data/005_fst_matrix_addPi_manual.txt")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
head(df)
levels(df$Group)
df$Group <- factor(df$Group,levels = c("Wild_emmer","Domesticated_emmer",
        "Free_threshing_tetraploid","Landrace","Cultivar"),ordered = TRUE)
colB <- c("#ffd702","#7f5701","#016699","#fc6e6e","#9900ff")

p <- ggplot(df,aes(x=Dim.1,y=Dim.2,size=Pi,shape=Sub))+
  geom_point(aes(fill=Group,color=Group),alpha=0.8)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  scale_shape_manual(values=c(23, 21), name="Subgenome")+
  scale_fill_manual(values = colB,name="Genetic group")+
  scale_color_manual(values = colB,name="Genetic group")+
  xlab("Dimension 1 (57.32%)")+ ylab("Dimension 2 (26.77%)")+
  theme(panel.background = element_rect(size = 0.7, colour = 'black',fill = 'white'),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        # legend.position = 'none',
        legend.key = element_blank(),
        text = element_text(size = 18))
p
ggsave(p,filename = "/Users/Aoyue/Documents/test.pdf",height = 5,width = 7)

```

```{r}
dataFile <- c("data/005_fst_matrix_Dsub_addPi_manual.txt")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
head(df)
levels(df$Group)
df$Group <- factor(df$Group,
                   levels = c("Ae.tauschii","Landrace","Cultivar"),ordered = TRUE)
colB <- c("#87cef9","#9900ff","#fc6e6e")
p <- ggplot(df,aes(x=Dim.1,y=Dim.2,fill=Group,size=Pi,shape=Sub))+
  geom_point(aes(color=df$Group),alpha=1)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  scale_shape_manual(values=c(24), name="Subgenome")+
  scale_fill_manual(values = colB,name="Genetic group")+
  scale_color_manual(values = colB,name="Genetic group")+
  scale_x_continuous(limits = c(-1.35,2.6),breaks = seq(-1,2,1))+
  scale_y_continuous(limits = c(-0.8,0.8),breaks = seq(-0.8,0.8,0.4))+
  xlab("Dimension 1 (99.3%)")+ ylab("Dimension 2 (0.7%)")+
  theme(panel.background = element_rect(size = 0.7, colour = 'black',fill = 'white'),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        legend.position = 'none',
        legend.key = element_blank(),
        text = element_text(size = 12))
p
ggsave(p,filename = "/Users/Aoyue/Documents/test2.pdf",height = 3,width = 4)

```

- legend
```{r}
### 画图例
dataFile <- c("data/005_fst_matrix_Dsub_addPi_manual.txt")
df <- read.table(dataFile, header=TRUE, sep="\t",row.names=NULL)
head(df)
levels(df$Group)
df$Group <- factor(df$Group,
                   levels = c("Ae.tauschii","Landrace","Cultivar"),ordered = TRUE)
colB <- c("#87cef9","#9900ff","#fc6e6e")
p <- ggplot(df,aes(x=Dim.1,y=Dim.2,size=Pi,shape=Sub))+
  geom_point(aes(fill=Group,color=Group),alpha=0.8)+
  geom_hline(yintercept=0.01, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0.985, linetype="dashed", color = "black")+
  scale_shape_manual(values=c(24), name="Subgenome")+
  scale_fill_manual(values = colB,name="Genetic group")+
  scale_color_manual(values = colB,name="Genetic group")+
  xlab("Dimension 1 (99.3%)")+ ylab("Dimension 2 (0.7%)")+
  theme(panel.background = element_rect(size = 0.7, colour = 'black',fill = 'white'),
        panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        # legend.position = 'none',
        legend.key = element_blank(),
        text = element_text(size = 18))
p
ggsave(p,filename = "/Users/Aoyue/Documents/test.pdf",height = 5,width = 7)
```


## ======================
## PCA by subspecies
### A sub

```{r}
library(factoextra)
library(FactoMineR)
### important data
df <- read.table("data/pop_para/pca/002_matrix_Asub.txt.gz",header = T,sep = "\t",row.names = 1) # 第一列是taxa
#colnames(df)
c1 <- which(colnames(df) == 'GenomeType')
c2 <- which(colnames(df) == 'Part_Continent')
c3 <- which(colnames(df) == 'Continent_forTree')
c4 <- which(colnames(df) == 'IndexforMutationBurden')
c5 <- which(colnames(df) == 'Subspecies')
c6 <- which(colnames(df) == 'Continent_by7')

df.pca <- PCA(df[,-c(c1,c2,c3,c4,c5,c6)],graph = F)
### 提取变异解释度并合并数据
variance1 <-  paste(round(df.pca$eig[1,3],2),"%",sep="")  ##第一个成分
variance2 <-  paste(round(df.pca$eig[2,3] - df.pca$eig[1,3],2),"%",sep="") ##第二个成分
dfpca <- as.data.frame(df.pca$ind$coord)
df <- cbind(df,dfpca)
### start to plot
levels(as.factor(df$Subspecies) )
df$Subspecies <- factor(df$Subspecies,levels = c("Wild_emmer","Domesticated_emmer","Free_threshing_tetraploid","OtherTetraploid","Landrace","Cultivar","OtherHexaploid"))
colB <- c('#ffd702','#7f5701','#016699','#00f3ff','#fc6e6e','#9900ff','#fe63c2')
p <- ggplot(df,aes(x=Dim.1,y=Dim.2,fill=Subspecies, shape = Continent_forTree))+
  # geom_point(aes(color=Subspecies),alpha=0.5,size=2)+
  geom_point(alpha=0.8,size=2,color="gray")+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  scale_shape_manual(values=c(23, 22,21,24,25), name="Continent")+
  # scale_shape_manual(values=c(15, 16,17,18,19), name="Continent")+
  # scale_color_manual(values = colB,name="Genetic group")+
  scale_fill_manual(values = colB,name="Genetic group")+
  labs(x=paste("PC1 ","(",variance1,")",sep = ""), y=paste("PC2 ","(",variance2,")",sep = ""))+
  theme_classic()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
      panel.background = element_blank(),
      axis.line = element_line(size=0.3, colour = "black"),
      legend.position = 'none',
      text = element_text(size = 12))  
p
ggsave(p,filename = "~/Documents/p1.pdf",height = 3,width = 3)

library(plotly)
fig <- df %>%
  # filter( ! Taxa == "AB_183", ! Taxa == "AB_185" ) %>% 
  # filter(Subspecies %in% c("Landrace_Yunnan","yunna-nense")) %>%
  # filter(Subspecies == "Spelt_CAU" |Subspecies == "spelta") %>%
  # filter(Subspecies %in% c("petropavlovskyi","Landrace_Xinjiang")) %>%
  # filter(Subspecies == "Landrace",Group %in% c("JiaoLab","LuLab","CAAS") ) %>%
  plot_ly(x = ~ Dim.1, y = ~ Dim.2,color = ~ Subspecies,
               # text = ~paste(Taxa),
               colors = colB)

fig

```
### B sub
```{r}
library(factoextra)
library(FactoMineR)
### important data
df <- read.table("data/pop_para/pca/002_matrix_Bsub.txt.gz",header = T,sep = "\t",row.names = 1) # 第一列是taxa
#colnames(df)
c1 <- which(colnames(df) == 'GenomeType')
c2 <- which(colnames(df) == 'Part_Continent')
c3 <- which(colnames(df) == 'Continent_forTree')
c4 <- which(colnames(df) == 'IndexforMutationBurden')
c5 <- which(colnames(df) == 'Subspecies')
c6 <- which(colnames(df) == 'Continent_by7')

df.pca <- PCA(df[,-c(c1,c2,c3,c4,c5,c6)],graph = F)
### 提取变异解释度并合并数据
variance1 <-  paste(round(df.pca$eig[1,3],2),"%",sep="")  ##第一个成分
variance2 <-  paste(round(df.pca$eig[2,3] - df.pca$eig[1,3],2),"%",sep="") ##第二个成分
dfpca <- as.data.frame(df.pca$ind$coord)
df <- cbind(df,dfpca)
### start to plot
levels(as.factor(df$Subspecies) )
df$Subspecies <- factor(df$Subspecies,levels = c("Wild_emmer","Domesticated_emmer","Free_threshing_tetraploid","OtherTetraploid","Landrace","Cultivar","OtherHexaploid"))
colB <- c('#ffd702','#7f5701','#016699','#00f3ff','#fc6e6e','#9900ff','#fe63c2')
p <- ggplot(df,aes(x=Dim.1,y=Dim.2,fill=Subspecies, shape = Continent_forTree))+
  # geom_point(aes(color=Subspecies),alpha=0.5,size=2)+
  geom_point(alpha=0.8,size=2,color="gray")+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  scale_shape_manual(values=c(23, 22,21,24,25), name="Continent")+
  # scale_shape_manual(values=c(15, 16,17,18,19), name="Continent")+
  # scale_color_manual(values = colB,name="Genetic group")+
  scale_fill_manual(values = colB,name="Genetic group")+
  labs(x=paste("PC1 ","(",variance1,")",sep = ""), y=paste("PC2 ","(",variance2,")",sep = ""))+
  theme_classic()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()
      ,panel.background = element_blank()
      ,axis.line = element_line(size=0.3, colour = "black")
      ,legend.position = 'none'
      ,text = element_text(size = 12))  
p
ggsave(p,filename = "~/Documents/p2.pdf",height = 3,width = 3)
```
### D sub
```{r}
library(factoextra)
library(FactoMineR)
### important data
df <- read.table("data/pop_para/pca/002_matrix_Dsub.txt.gz",header = T,sep = "\t",row.names = 1) # 第一列是taxa
#colnames(df)
c1 <- which(colnames(df) == 'GenomeType')
c2 <- which(colnames(df) == 'Part_Continent')
c3 <- which(colnames(df) == 'Continent_forTree')
c4 <- which(colnames(df) == 'IndexforMutationBurden')
c5 <- which(colnames(df) == 'Subspecies')
c6 <- which(colnames(df) == 'Continent_by7')

df.pca <- PCA(df[,-c(c1,c2,c3,c4,c5,c6)],graph = F)
### 提取变异解释度并合并数据
variance1 <-  paste(round(df.pca$eig[1,3],2),"%",sep="")  ##第一个成分
variance2 <-  paste(round(df.pca$eig[2,3] - df.pca$eig[1,3],2),"%",sep="") ##第二个成分
dfpca <- as.data.frame(df.pca$ind$coord)
df <- cbind(df,dfpca)
### start to plot
levels(as.factor(df$Subspecies) )
df$Subspecies <- factor(df$Subspecies,levels = c("Ae.tauschii","Landrace","Cultivar","OtherHexaploid"))
colB <- c("#87cef9",'#fc6e6e','#9900ff','#fe63c2')
p <- ggplot(df,aes(x=Dim.1,y=Dim.2,fill=Subspecies, shape = Continent_forTree))+
  # geom_point(aes(color=Subspecies),alpha=0.5,size=2)+
  geom_point(alpha=0.8,size=2,color="gray")+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  scale_shape_manual(values=c(23, 22,21,24,25), name="Continent")+
  # scale_shape_manual(values=c(15, 16,17,18,19), name="Continent")+
  # scale_color_manual(values = colB,name="Genetic group")+
  scale_fill_manual(values = colB,name="Genetic group")+
  labs(x=paste("PC1 ","(",variance1,")",sep = ""), y=paste("PC2 ","(",variance2,")",sep = ""))+
  theme_classic()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()
      ,panel.background = element_blank()
      ,axis.line = element_line(size=0.3, colour = "black")
      ,legend.position = 'none'
      ,text = element_text(size = 12))  
p
ggsave(p,filename = "~/Documents/p3.pdf",height = 3,width = 3)
```
### legend
```{r}
library(factoextra)
library(FactoMineR)
### important data
df <- read.table("data/pop_para/pca/002_matrix_Bsub.txt.gz",header = T,sep = "\t",row.names = 1) # 第一列是taxa
#colnames(df)
c1 <- which(colnames(df) == 'GenomeType')
c2 <- which(colnames(df) == 'Part_Continent')
c3 <- which(colnames(df) == 'Continent_forTree')
c4 <- which(colnames(df) == 'IndexforMutationBurden')
c5 <- which(colnames(df) == 'Subspecies')
c6 <- which(colnames(df) == 'Continent_by7')

df.pca <- PCA(df[,-c(c1,c2,c3,c4,c5,c6)],graph = F)
### 提取变异解释度并合并数据
variance1 <-  paste(round(df.pca$eig[1,3],2),"%",sep="")  ##第一个成分
variance2 <-  paste(round(df.pca$eig[2,3] - df.pca$eig[1,3],2),"%",sep="") ##第二个成分
dfpca <- as.data.frame(df.pca$ind$coord)
df <- cbind(df,dfpca)
### start to plot
levels(as.factor(df$Subspecies) )
df$Subspecies <- factor(df$Subspecies,levels = c("Wild_emmer","Domesticated_emmer","Free_threshing_tetraploid","OtherTetraploid","Landrace","Cultivar","OtherHexaploid"))
colB <- c('#ffd702','#7f5701','#016699','#00f3ff','#fc6e6e','#9900ff','#fe63c2')
p <- ggplot(df,aes(x=Dim.1,y=Dim.2,fill=Subspecies, shape = Continent_forTree))+
  # geom_point(aes(color=Subspecies),alpha=0.5,size=2)+
  geom_point(alpha=0.8,size=2,color="gray")+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  scale_shape_manual(values=c(23, 22,21,24,25), name="Continent")+
  # scale_shape_manual(values=c(15, 16,17,18,19), name="Continent")+
  # scale_color_manual(values = colB,name="Genetic group")+
  scale_fill_manual(values = colB,name="Genetic group")+
  labs(x=paste("PC1 ","(",variance1,")",sep = ""), y=paste("PC2 ","(",variance2,")",sep = ""))+
  theme_classic()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()
      ,panel.background = element_blank()
      ,axis.line = element_line(size=0.3, colour = "black")
      # ,legend.position = 'none'
      ,text = element_text(size = 12))  
p
ggsave(p,filename = "~/Documents/legend.pdf",height = 3,width = 3)
```
### hexaploid
```{r}
library(factoextra)
library(FactoMineR)
### important data
df <- read.table("data/pop_para/pca/003_matrix_hexa.txt.gz",header = T,sep = "\t",row.names = 1) # 第一列是taxa
#colnames(df)
c1 <- which(colnames(df) == 'GenomeType')
c2 <- which(colnames(df) == 'Part_Continent')
c3 <- which(colnames(df) == 'Continent_forTree')
c4 <- which(colnames(df) == 'IndexforMutationBurden')
c5 <- which(colnames(df) == 'Subspecies')
c6 <- which(colnames(df) == 'Continent_by7')

df.pca <- PCA(df[,-c(c1,c2,c3,c4,c5,c6)],graph = F)
### 提取变异解释度并合并数据
variance1 <-  paste(round(df.pca$eig[1,3],2),"%",sep="")  ##第一个成分
variance2 <-  paste(round(df.pca$eig[2,3] - df.pca$eig[1,3],2),"%",sep="") ##第二个成分
dfpca <- as.data.frame(df.pca$ind$coord)
df <- cbind(df,dfpca)
### start to plot
levels(as.factor(df$Subspecies) )

colotherHexaploid <- brewer.pal(8,"Set1")[1:7]
colB <- c("#9900ff","#fc6e6e","#fe63c2",colotherHexaploid,"gray")

p <- ggplot(df,aes(x=Dim.1,y=Dim.2,fill=as.character(IndexforMutationBurden)))+
  # geom_point(aes(color=Subspecies),alpha=0.5,size=2)+
  geom_point(alpha=0.8,size=2,color="gray",shape=21)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  # scale_shape_manual(values=c(23, 22,21,24,25), name="Continent")+
  # scale_shape_manual(values=c(15, 16,17,18,19), name="Continent")+
  # scale_color_manual(values = colB,name="Genetic group")+
  scale_fill_manual(values = colB,name="Genetic group")+
  # scale_shape_manual(values = shapeB)+
  labs(x=paste("PC1 ","(",variance1,")",sep = ""), y=paste("PC2 ","(",variance2,")",sep = ""))+
  theme_classic()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()
      ,panel.background = element_blank()
      ,axis.line = element_line(size=0.3, colour = "black")
      ,legend.position = 'none'
      ,text = element_text(size = 12))  
p
ggsave(p,filename = "~/Documents/p4.pdf",height = 3,width = 3)
```
### hexaploid legend
```{r}
library(factoextra)
library(FactoMineR)
### important data
df <- read.table("data/pop_para/pca/003_matrix_hexa.txt.gz",header = T,sep = "\t",row.names = 1) # 第一列是taxa
#colnames(df)
c1 <- which(colnames(df) == 'GenomeType')
c2 <- which(colnames(df) == 'Part_Continent')
c3 <- which(colnames(df) == 'Continent_forTree')
c4 <- which(colnames(df) == 'IndexforMutationBurden')
c5 <- which(colnames(df) == 'Subspecies')
c6 <- which(colnames(df) == 'Continent_by7')

df.pca <- PCA(df[,-c(c1,c2,c3,c4,c5,c6)],graph = F)
### 提取变异解释度并合并数据
variance1 <-  paste(round(df.pca$eig[1,3],2),"%",sep="")  ##第一个成分
variance2 <-  paste(round(df.pca$eig[2,3] - df.pca$eig[1,3],2),"%",sep="") ##第二个成分
dfpca <- as.data.frame(df.pca$ind$coord)
df <- cbind(df,dfpca)
### start to plot
levels(as.factor(df$Subspecies) )

colotherHexaploid <- brewer.pal(8,"Set1")[1:7]
colB <- c("#9900ff","#fc6e6e","#fe63c2",colotherHexaploid,"gray")

p <- ggplot(df,aes(x=Dim.1,y=Dim.2,fill=as.character(IndexforMutationBurden)))+
  # geom_point(aes(color=Subspecies),alpha=0.5,size=2)+
  geom_point(alpha=0.8,size=2,color="gray",shape=21)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  # scale_shape_manual(values=c(23, 22,21,24,25), name="Continent")+
  # scale_shape_manual(values=c(15, 16,17,18,19), name="Continent")+
  # scale_color_manual(values = colB,name="Genetic group")+
  scale_fill_manual(values = colB,name="Genetic group")+
  # scale_shape_manual(values = shapeB)+
  labs(x=paste("PC1 ","(",variance1,")",sep = ""), y=paste("PC2 ","(",variance2,")",sep = ""))+
  theme_classic()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()
      ,panel.background = element_blank()
      ,axis.line = element_line(size=0.3, colour = "black")
      # ,legend.position = 'none'
      ,text = element_text(size = 12))  
p
ggsave(p,filename = "~/Documents/p4_legend.pdf",height = 3,width = 3)
```


### tetraploid
```{r}
library(factoextra)
library(FactoMineR)
### important data
df <- read.table("data/pop_para/pca/004_matrix_tetra.txt.gz",header = T,sep = "\t",row.names = 1) # 第一列是taxa
#colnames(df)
c1 <- which(colnames(df) == 'GenomeType')
c2 <- which(colnames(df) == 'Part_Continent')
c3 <- which(colnames(df) == 'Continent_forTree')
c4 <- which(colnames(df) == 'IndexforMutationBurden')
c5 <- which(colnames(df) == 'Subspecies')
c6 <- which(colnames(df) == 'Continent_by7')

df.pca <- PCA(df[,-c(c1,c2,c3,c4,c5,c6)],graph = F)
### 提取变异解释度并合并数据
variance1 <-  paste(round(df.pca$eig[1,3],2),"%",sep="")  ##第一个成分
variance2 <-  paste(round(df.pca$eig[2,3] - df.pca$eig[1,3],2),"%",sep="") ##第二个成分
dfpca <- as.data.frame(df.pca$ind$coord)
df <- cbind(df,dfpca)
### start to plot
levels(as.factor(df$Subspecies) )

colother <- brewer.pal(8,"Dark2")
colB <- c("cyan", "#ffd702","#7f5701","#016699",colother[2:5],colother[8])

p <- ggplot(df,aes(x=Dim.1,y=Dim.2,fill=as.character(IndexforMutationBurden)))+
  # geom_point(aes(color=Subspecies),alpha=0.5,size=2)+
  geom_point(alpha=0.8,size=2,color="gray",shape=21)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  # scale_shape_manual(values=c(23, 22,21,24,25), name="Continent")+
  # scale_shape_manual(values=c(15, 16,17,18,19), name="Continent")+
  # scale_color_manual(values = colB,name="Genetic group")+
  scale_fill_manual(values = colB,name="Genetic group")+
  # scale_shape_manual(values = shapeB)+
  labs(x=paste("PC1 ","(",variance1,")",sep = ""), y=paste("PC2 ","(",variance2,")",sep = ""))+
  theme_classic()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()
      ,panel.background = element_blank()
      ,axis.line = element_line(size=0.3, colour = "black")
      ,legend.position = 'none'
      ,text = element_text(size = 12))  
p
ggsave(p,filename = "~/Documents/p5.pdf",height = 3,width = 3)
```
### tetraploid legend
```{r}
library(factoextra)
library(FactoMineR)
### important data
df <- read.table("data/pop_para/pca/004_matrix_tetra.txt.gz",header = T,sep = "\t",row.names = 1) # 第一列是taxa
#colnames(df)
c1 <- which(colnames(df) == 'GenomeType')
c2 <- which(colnames(df) == 'Part_Continent')
c3 <- which(colnames(df) == 'Continent_forTree')
c4 <- which(colnames(df) == 'IndexforMutationBurden')
c5 <- which(colnames(df) == 'Subspecies')
c6 <- which(colnames(df) == 'Continent_by7')

df.pca <- PCA(df[,-c(c1,c2,c3,c4,c5,c6)],graph = F)
### 提取变异解释度并合并数据
variance1 <-  paste(round(df.pca$eig[1,3],2),"%",sep="")  ##第一个成分
variance2 <-  paste(round(df.pca$eig[2,3] - df.pca$eig[1,3],2),"%",sep="") ##第二个成分
dfpca <- as.data.frame(df.pca$ind$coord)
df <- cbind(df,dfpca)
### start to plot
levels(as.factor(df$Subspecies) )

colother <- brewer.pal(8,"Dark2")
colB <- c("cyan", "#ffd702","#7f5701","#016699",colother[2:5],colother[8])

p <- ggplot(df,aes(x=Dim.1,y=Dim.2,fill=as.character(IndexforMutationBurden)))+
  # geom_point(aes(color=Subspecies),alpha=0.5,size=2)+
  geom_point(alpha=0.8,size=2,color="gray",shape=21)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  # scale_shape_manual(values=c(23, 22,21,24,25), name="Continent")+
  # scale_shape_manual(values=c(15, 16,17,18,19), name="Continent")+
  # scale_color_manual(values = colB,name="Genetic group")+
  scale_fill_manual(values = colB,name="Genetic group")+
  # scale_shape_manual(values = shapeB)+
  labs(x=paste("PC1 ","(",variance1,")",sep = ""), y=paste("PC2 ","(",variance2,")",sep = ""))+
  theme_classic()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()
      ,panel.background = element_blank()
      ,axis.line = element_line(size=0.3, colour = "black")
      # ,legend.position = 'none'
      ,text = element_text(size = 12))  
p
ggsave(p,filename = "~/Documents/p5_legend.pdf",height = 3,width = 3)
```


### all
```{r}

```

### hexaploid
```{r}
library(factoextra)
library(FactoMineR)
### important data
df <- read.table("data/pop_para/pca/003_matrix_hexa.txt.gz",header = T,sep = "\t",row.names = 1) # 第一列是taxa
#colnames(df)
c1 <- which(colnames(df) == 'GenomeType')
c2 <- which(colnames(df) == 'Part_Continent')
c3 <- which(colnames(df) == 'Continent_forTree')
c4 <- which(colnames(df) == 'IndexforMutationBurden')
c5 <- which(colnames(df) == 'Subspecies')
c6 <- which(colnames(df) == 'Continent_by7')

df.pca <- PCA(df[,-c(c1,c2,c3,c4,c5,c6)],graph = F)
### 提取变异解释度并合并数据
variance1 <-  paste(round(df.pca$eig[1,3],2),"%",sep="")  ##第一个成分
variance2 <-  paste(round(df.pca$eig[2,3] - df.pca$eig[1,3],2),"%",sep="") ##第二个成分
dfpca <- as.data.frame(df.pca$ind$coord)
df <- cbind(df,dfpca)
### start to plot
levels(as.factor(df$Subspecies) )

colB <- c(c('#7B241C','#dbb3ff','#A9A9A9','#fc6e6e','#FF9900','#7dbde8','#82C782'))
shapeB <- c(16,8,18,6,15,7,17)

p <- ggplot(df,aes(x=Dim.1,y=Dim.2))+
  # geom_point(aes(color=Subspecies),alpha=0.5,size=2)+
  geom_point(aes(col=df$Continent_by7,shape=df$Continent_by7),alpha=0.8,size=2)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  scale_color_manual(values = colB,name="Genetic group")+
  scale_shape_manual(values = shapeB)+
  labs(x=paste("PC1 ","(",variance1,")",sep = ""), y=paste("PC2 ","(",variance2,")",sep = ""))+
  theme_classic()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()
      ,panel.background = element_blank()
      ,axis.line = element_line(size=0.3, colour = "black")
      ,legend.position = 'none'
      ,text = element_text(size = 12))  
p
ggsave(p,filename = "~/Documents/p6.pdf",height = 3,width = 3)

```
### hexaploid legend
```{r}
library(factoextra)
library(FactoMineR)
### important data
df <- read.table("data/pop_para/pca/003_matrix_hexa.txt.gz",header = T,sep = "\t",row.names = 1) # 第一列是taxa
#colnames(df)
c1 <- which(colnames(df) == 'GenomeType')
c2 <- which(colnames(df) == 'Part_Continent')
c3 <- which(colnames(df) == 'Continent_forTree')
c4 <- which(colnames(df) == 'IndexforMutationBurden')
c5 <- which(colnames(df) == 'Subspecies')
c6 <- which(colnames(df) == 'Continent_by7')

df.pca <- PCA(df[,-c(c1,c2,c3,c4,c5,c6)],graph = F)
### 提取变异解释度并合并数据
variance1 <-  paste(round(df.pca$eig[1,3],2),"%",sep="")  ##第一个成分
variance2 <-  paste(round(df.pca$eig[2,3] - df.pca$eig[1,3],2),"%",sep="") ##第二个成分
dfpca <- as.data.frame(df.pca$ind$coord)
df <- cbind(df,dfpca)
### start to plot
levels(as.factor(df$Subspecies) )

colB <- c(c('#7B241C','#dbb3ff','#A9A9A9','#fc6e6e','#FF9900','#7dbde8','#82C782'))
shapeB <- c(16,8,18,6,15,7,17)

p <- ggplot(df,aes(x=Dim.1,y=Dim.2))+
  # geom_point(aes(color=Subspecies),alpha=0.5,size=2)+
  geom_point(aes(col=df$Continent_by7,shape=df$Continent_by7),alpha=0.8,size=2)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  scale_color_manual(values = colB)+
  scale_shape_manual(values = shapeB)+
  labs(x=paste("PC1 ","(",variance1,")",sep = ""), y=paste("PC2 ","(",variance2,")",sep = ""))+
  theme_classic()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()
      ,panel.background = element_blank()
      ,axis.line = element_line(size=0.3, colour = "black")
      # ,legend.position = 'none'
      ,text = element_text(size = 12))  
p
ggsave(p,filename = "~/Documents/p6_legend.pdf",height = 3,width = 3)
```

### tetraploid
```{r}
library(factoextra)
library(FactoMineR)
### important data
df <- read.table("data/pop_para/pca/004_matrix_tetra.txt.gz",header = T,sep = "\t",row.names = 1) # 第一列是taxa
#colnames(df)
c1 <- which(colnames(df) == 'GenomeType')
c2 <- which(colnames(df) == 'Part_Continent')
c3 <- which(colnames(df) == 'Continent_forTree')
c4 <- which(colnames(df) == 'IndexforMutationBurden')
c5 <- which(colnames(df) == 'Subspecies')
c6 <- which(colnames(df) == 'Continent_by7')

df.pca <- PCA(df[,-c(c1,c2,c3,c4,c5,c6)],graph = F)
### 提取变异解释度并合并数据
variance1 <-  paste(round(df.pca$eig[1,3],2),"%",sep="")  ##第一个成分
variance2 <-  paste(round(df.pca$eig[2,3] - df.pca$eig[1,3],2),"%",sep="") ##第二个成分
dfpca <- as.data.frame(df.pca$ind$coord)
df <- cbind(df,dfpca)
### start to plot
levels(as.factor(df$Subspecies) )

colB <- c(c('#7B241C','#dbb3ff','#A9A9A9','#fc6e6e','#FF9900','#82C782'))
shapeB <- c(16,8,18,6,15,17)

p <- ggplot(df,aes(x=Dim.1,y=Dim.2))+
  # geom_point(aes(color=Subspecies),alpha=0.5,size=2)+
  geom_point(aes(col=df$Continent_by7,shape=df$Continent_by7),alpha=0.8,size=2)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  scale_color_manual(values = colB)+
  scale_shape_manual(values = shapeB)+
  labs(x=paste("PC1 ","(",variance1,")",sep = ""), y=paste("PC2 ","(",variance2,")",sep = ""))+
  theme_classic()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()
      ,panel.background = element_blank()
      ,axis.line = element_line(size=0.3, colour = "black")
      ,legend.position = 'none'
      ,text = element_text(size = 12))  
p
ggsave(p,filename = "~/Documents/p7.pdf",height = 3,width = 3)
```
### tetraploid legend
```{r}
library(factoextra)
library(FactoMineR)
### important data
df <- read.table("data/pop_para/pca/004_matrix_tetra.txt.gz",header = T,sep = "\t",row.names = 1) # 第一列是taxa
#colnames(df)
c1 <- which(colnames(df) == 'GenomeType')
c2 <- which(colnames(df) == 'Part_Continent')
c3 <- which(colnames(df) == 'Continent_forTree')
c4 <- which(colnames(df) == 'IndexforMutationBurden')
c5 <- which(colnames(df) == 'Subspecies')
c6 <- which(colnames(df) == 'Continent_by7')

df.pca <- PCA(df[,-c(c1,c2,c3,c4,c5,c6)],graph = F)
### 提取变异解释度并合并数据
variance1 <-  paste(round(df.pca$eig[1,3],2),"%",sep="")  ##第一个成分
variance2 <-  paste(round(df.pca$eig[2,3] - df.pca$eig[1,3],2),"%",sep="") ##第二个成分
dfpca <- as.data.frame(df.pca$ind$coord)
df <- cbind(df,dfpca)
### start to plot
levels(as.factor(df$Subspecies) )

colB <- c(c('#7B241C','#dbb3ff','#A9A9A9','#fc6e6e','#FF9900','#82C782'))
shapeB <- c(16,8,18,6,15,17)

p <- ggplot(df,aes(x=Dim.1,y=Dim.2))+
  # geom_point(aes(color=Subspecies),alpha=0.5,size=2)+
  geom_point(aes(col=df$Continent_by7,shape=df$Continent_by7),alpha=0.8,size=2)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  scale_color_manual(values = colB)+
  scale_shape_manual(values = shapeB)+
  labs(x=paste("PC1 ","(",variance1,")",sep = ""), y=paste("PC2 ","(",variance2,")",sep = ""))+
  theme_classic()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()
      ,panel.background = element_blank()
      ,axis.line = element_line(size=0.3, colour = "black")
      # ,legend.position = 'none'
      ,text = element_text(size = 12))  
p
ggsave(p,filename = "~/Documents/p7_legend.pdf",height = 3,width = 3)
```

### diploid
```{r}
library(factoextra)
library(FactoMineR)
### important data
df <- read.table("data/pop_para/pca/005_matrix_DD.txt.gz",header = T,sep = "\t",row.names = 1) # 第一列是taxa
#colnames(df)
c1 <- which(colnames(df) == 'GenomeType')
c2 <- which(colnames(df) == 'Part_Continent')
c3 <- which(colnames(df) == 'Continent_forTree')
c4 <- which(colnames(df) == 'IndexforMutationBurden')
c5 <- which(colnames(df) == 'Subspecies')
c6 <- which(colnames(df) == 'Continent_by7')

df.pca <- PCA(df[,-c(c1,c2,c3,c4,c5,c6)],graph = F)
### 提取变异解释度并合并数据
variance1 <-  paste(round(df.pca$eig[1,3],2),"%",sep="")  ##第一个成分
variance2 <-  paste(round(df.pca$eig[2,3] - df.pca$eig[1,3],2),"%",sep="") ##第二个成分
dfpca <- as.data.frame(df.pca$ind$coord)
df <- cbind(df,dfpca)
### start to plot
levels(as.factor(df$Subspecies) )

colB <- c('#dbb3ff','#FF9900','#82C782')
shapeB <- c(8,15,17)

p <- ggplot(df,aes(x=Dim.1,y=Dim.2))+
  # geom_point(aes(color=Subspecies),alpha=0.5,size=2)+
  geom_point(aes(col=df$Continent_by7,shape=df$Continent_by7),alpha=0.8,size=2)+
  geom_hline(yintercept=0, linetype="dashed", color = "black")+
  geom_vline(xintercept = 0, linetype="dashed", color = "black")+
  scale_color_manual(values = colB)+
  scale_shape_manual(values = shapeB)+
  labs(x=paste("PC1 ","(",variance1,")",sep = ""), y=paste("PC2 ","(",variance2,")",sep = ""))+
  theme_classic()+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()
      ,panel.background = element_blank()
      ,axis.line = element_line(size=0.3, colour = "black")
      ,legend.position = 'none'
      ,text = element_text(size = 12))  
p
ggsave(p,filename = "~/Documents/p7_legend.pdf",height = 3,width = 3)

```







